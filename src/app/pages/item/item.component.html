<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <p [innerHTML]="'ITEM.REQUIRED_TEXT' | translate"></p>
  <div class="form-field">
    <label for="brand-select">
      {{ 'ITEM.FIELDS.LABELS.BRAND' | translate }}
      <span>*</span>
    </label>
    <ng-select id="brand-select" formControlName="brand" [items]="brands" bindLabel="name" required></ng-select>
    <p class="error visualy-hidden" *ngIf="brand.errors?.required">{{ 'ITEM.ERRORS.REQUIRED' | translate }}</p>
  </div>
  <div class="form-field">
    <label for="collectionn-input">
      {{ 'ITEM.FIELDS.LABELS.COLLECTIONN' | translate }}
    </label>
    <details class="right">
      <summary>
        <span class="visualy-hidden">{{ 'ITEM.DETAILS.HOW_TO' | translate }}</span>
        <span class="help-icon" aria-hidden="true">?</span>
      </summary>
      <div class="details-content">
        <p [innerHTML]="'ITEM.HELPS.COLLECTION' | translate"></p>
      </div>
    </details>
    <input type="text" id="collectionn-input" formControlName="collectionn">
  </div>
  <div class="form-field">
    <label for="category-select">
      {{ 'ITEM.FIELDS.LABELS.CATEGORY' | translate }}
      <span>*</span>
    </label>
    <ng-select id="category-select" formControlName="category" [items]="categories" bindLabel="name" required>
      <ng-template ng-option-tmp let-item="item">
        <span [ngClass]="item._lvlClass">{{ item.name }}</span>
      </ng-template>
    </ng-select>
    <p class="error visualy-hidden" *ngIf="category.errors?.required">{{ 'ITEM.ERRORS.REQUIRED' | translate }}</p>
  </div>
  <div class="form-field">
    <label for="features-select">
      {{ 'ITEM.FIELDS.LABELS.FEATURES' | translate }}
    </label>
    <ng-select id="features-select" formControlName="features" [items]="featuresData" [multiple]="true" bindLabel="name">
      <ng-template ng-option-tmp let-item="item">
        <span>{{ item.name }}</span>
      </ng-template>
      <ng-template ng-label-tmp let-item="item" let-clear="clear">
        <span class="ng-value-content">
          <span class="ng-value-icon left" (click)="clear(item);" aria-hidden="true">×</span>
          <span class="ng-value-label">
            {{ item.name }}
          </span>
        </span>
      </ng-template>
    </ng-select>
    <p class="error visualy-hidden" *ngIf="features.errors?.required">{{ 'ITEM.ERRORS.REQUIRED' | translate }}</p>
  </div>
  <ng-container formArrayName="variants">
    <app-fieldset *ngFor="let variant of variants.controls; let i = index" [formGroupName]="i" [legend]="'ITEM.FIELDS.LEGENDS.VARIANT' | translate:{i: i+1}" [opened]="true">
      <div class="form-field">
        <label [attr.for]="'colors-select-' + i">
          {{ 'ITEM.FIELDS.LABELS.COLORS' | translate }}
          <span>*</span>
        </label>
        <ng-select [attr.id]="'colors-select-' + i" formControlName="colors" [items]="colors" [virtualScroll]="true" [multiple]="true" bindLabel="name" required>
          <ng-template ng-option-tmp let-item="item">
            {{ item.name }}
            <span class="color-display" aria-hidden="true" [ngStyle]="{background: item.hex}"></span>
          </ng-template>
          <ng-template ng-label-tmp let-item="item" let-clear="clear">
            <span class="ng-value-content">
              <span class="ng-value-icon left" (click)="clear(item);" aria-hidden="true">×</span>
              <span class="ng-value-label">
                {{ item.name }}
                <span class="color-display" aria-hidden="true" [ngStyle]="{background: item.hex}"></span>
              </span>
            </span>
          </ng-template>
        </ng-select>
        <p class="error visualy-hidden" *ngIf="variants.controls[i].get('colors')?.errors?.required">{{ 'ITEM.ERRORS.REQUIRED' | translate }}</p>
      </div>
      <div class="form-field">
        <label [attr.for]="'variant-photo-' + i">
          {{ 'ITEM.FIELDS.LABELS.PHOTO' | translate }}
          <span>*</span>
        </label>
        <details class="right">
          <summary>
            <span class="visualy-hidden">{{ 'ITEM.DETAILS.HOW_TO' | translate }}</span>
            <span class="help-icon" aria-hidden="true">?</span>
          </summary>
          <div class="details-content">
            <p [innerHTML]="'ITEM.HELPS.PHOTO' | translate"></p>
          </div>
        </details>
        <input type="url" [attr.id]="'variant-photo-' + i" formControlName="photo" required [class.has-preview]="variants.controls[i].value.photo">
        <img class="photo-preview" *ngIf="variants.controls[i].value.photo" [attr.src]="variants.controls[i].value.photo" alt="">
        <p class="error visualy-hidden" *ngIf="variants.controls[i].get('photo')?.errors?.required">{{ 'ITEM.ERRORS.REQUIRED' | translate }}</p>
      </div>
      <button *ngIf="!(variants.length === 1 && i === 0)" app-button color="discreet" class="discreet very-small no-shadow fw-normal remove-variant" (click)="removeVariant(i)">
        <span>{{ 'ITEM.REMOVE_VARIANT' | translate }}</span>
      </button>
    </app-fieldset>
    <button type="button" app-button color="primary" class="small fw-normal add-variant" (click)="addVariant()">
      <span>{{ 'ITEM.ADD_VARIANT' | translate }}</span>
      <span class="add-icon small"></span>
    </button>
  </ng-container>

  <app-fieldset [legend]="'ITEM.FIELDS.LEGENDS.ADDITIONALS' | translate" class="additional-fields">
    <p [innerHTML]="'ITEM.HELPS.ADDITONALS' | translate"></p>
    <div class="form-field">
      <label for="year-input">
        {{ 'ITEM.FIELDS.LABELS.YEAR' | translate }}
      </label>
      <input type="text" id="year-input" formControlName="year">
    </div>
    <div class="form-field">
      <label for="japanese-input">
        {{ 'ITEM.FIELDS.LABELS.JAPANESE' | translate }}
      </label>
      <input type="text" id="japanese-input" formControlName="japanese">
    </div>
    <div class="form-field">
      <label for="measurments-input">
        {{ 'ITEM.FIELDS.LABELS.MEASURMENTS' | translate }}
      </label>
      <textarea formControlName="measurments" id="measurments-input"></textarea>
    </div>
    <div class="form-field">
      <label for="estimatedprice-input">
        {{ 'ITEM.FIELDS.LABELS.ESTIMATED_PRICE' | translate }}
      </label>
      <input type="number" id="estimatedprice-input" formControlName="estimatedPrice">
    </div>
    <div class="form-field">
      <label for="keywords-select">
        {{ 'ITEM.FIELDS.LABELS.KEYWORDS' | translate }}
      </label>
      <details class="right">
        <summary>
          <span class="visualy-hidden">{{ 'ITEM.DETAILS.HOW_TO' | translate }}</span>
          <span class="help-icon" aria-hidden="true">?</span>
        </summary>
        <div class="details-content">
          <p [innerHTML]="'ITEM.HELPS.KEYWORDS' | translate"></p>
        </div>
      </details>
      <ng-select id="keywords-select" formControlName="keywords" [multiple]="true" [items]="[]" [addTag]="true" [selectOnTab]="true" [isOpen]="false">
        <ng-template ng-label-tmp let-item="item" let-clear="clear">
          <span class="ng-value-content">
            <span class="ng-value-icon left" (click)="clear(item);" aria-hidden="true">×</span>
            <span class="ng-value-label">
              {{ item }}
            </span>
          </span>
        </ng-template>
      </ng-select>
    </div>
  </app-fieldset>

  <button type="submit" app-button class="circle" color="accent" [disabled]="form.invalid">
    <span class="visualy-hidden">{{ 'ITEM.SUBMIT' | translate }}</span>
    <svg *ngIf="editing" id="save_icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400">
      <defs>
        <style>
          .save-cls-1 {
            fill: var(--save-icon-1);
          }

          .save-cls-2 {
            fill: var(--save-icon-2);
          }

          .save-cls-3 {
            fill: var(--save-icon-2);
          }

          .save-cls-4 {
            fill: var(--save-icon-3);
          }
        </style>
      </defs>
      <path class="save-cls-1"
        d="M382.54,138.48a16.74,16.74,0,0,0-.65-3.34,12.43,12.43,0,0,0-1.05-2.11C369.71,115.6,313.26,61.4,313.26,61.4,289,38.12,282.32,26.83,262.91,22.27c-6.09-1.43-10.23-1.93-20.06-1.49-30,1.33-60.14-.45-90.2-.53-27.87-.07-47.53-.65-60.13-.21-1.85.07-7.79.3-16.11.26l.28-.57L74,19.9c-3.63.23-4.95.22-6.26.36a63.23,63.23,0,0,0-7.19,1.17C54.23,22.83,40.86,26,30.07,37.77,27.61,40.46,17.42,51.6,17.43,65.93a19.64,19.64,0,0,0,.14,2.47c-1.37,37.63-.48,125.39-.48,125.39,0,47.69-1.15,98.62-.53,137.14a65.13,65.13,0,0,0,1.52,13.45c1.4,6.31,4.56,19.68,16.35,30.47,2.69,2.46,13.83,12.65,28.15,12.64h63.14c5,.06,11.21.08,20.08,0H253c8.89.08,15.1.06,20.1,0h58c.42,0,1.34.06,2.59,0h.38v0l.52,0c.49,0,1,.06,1.63.06,14.33,0,25.47-10.18,28.16-12.64a49.53,49.53,0,0,0,4.95-5.29,43.07,43.07,0,0,0,12.34-20.3,37.69,37.69,0,0,0,.83-4.13h0V141.57A15.77,15.77,0,0,0,382.54,138.48Z" />
      <path class="save-cls-2" d="M76.69,19.73v62.5a21.36,21.36,0,0,0,21.36,21.36H214.1a21.36,21.36,0,0,0,21.36-21.36V19.73Z" />
      <rect class="save-cls-3" x="78.95" y="185.1" width="242.11" height="141.36" rx="19.78" />
      <path class="save-cls-4"
        d="M270.59,218.06A36,36,0,0,0,234,196.2a35.43,35.43,0,0,0-19.81,7.92,35,35,0,0,0-9.34,12.18l-.66,0a35,35,0,0,0-9.35-12.2A35.43,35.43,0,0,0,175,196.2a36,36,0,0,0-36.6,21.86,38.17,38.17,0,0,0-1.74,23.61c1.45,6.61,4.13,10.92,8.55,18.06a119.54,119.54,0,0,0,14,18.22c3.53,3.84,8.22,8.49,29,24.88,6.78,5.35,12.43,9.7,16.32,12.68v-2.34h0v2.34c3.89-3,9.55-7.33,16.32-12.68,20.78-16.39,25.47-21,29-24.88a118.7,118.7,0,0,0,13.94-18.22c4.43-7.14,7.1-11.45,8.56-18.06A38.17,38.17,0,0,0,270.59,218.06Z" />
    </svg>
    <svg *ngIf="!editing" id="modify_icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400">
      <defs>
        <style>
          .edit-cls-1 {
            fill: var(--edit-icon-2);
          }

          .edit-cls-2 {
            fill: none;
            stroke: var(--edit-icon-2);
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-width: 7px;
          }

          .edit-cls-3 {
            fill: var(--edit-icon-1);
          }

          .edit-cls-4 {
            fill: var(--edit-icon-3);
          }

          .edit-cls-5 {
            fill: var(--edit-icon-4);
          }
        </style>
      </defs>
      <path class="edit-cls-1"
        d="M99.24,238c-4.7,1.54-6.94,5.84-11.41,14.44-6.21,11.95-11.24,22.18-7.45,33.56,3.51,10.51,14.86,17.92,25.23,19.16,9,1.08,15.75-2.27,28.23-8.74,7.61-3.94,11.45-6,12.8-9.83,2.76-7.81-5.26-16.87-13.38-26C123.21,249.14,110.16,234.39,99.24,238Z" />
      <line class="edit-cls-2" x1="111.36" y1="304.1" x2="165.59" y2="288.48" />
      <line class="edit-cls-2" x1="99.24" y1="217.18" x2="81.36" y2="272.35" />
      <path class="edit-cls-3" d="M95.42,216.87c-9.42,19.95-.8,40.24,12.28,44.94,8.77,3.15,19.83-.61,28.15-8.5" />
      <rect class="edit-cls-3" x="82.7" y="111.65" width="276.38" height="107.42" rx="20.52" transform="translate(-52.23 204.62) rotate(-45)" />
      <path class="edit-cls-3"
        d="M130.68,250.5c-8.74,3-13.24,20.34-7.36,31.32,8.87,16.57,39.8,15.63,44.36,7.16,3.61-6.7-8.47-19.64-12.66-24.13C149.08,258.49,139,247.66,130.68,250.5Z" />
      <path class="edit-cls-5"
        d="M121.7,247.75l16.8,16.8a18.79,18.79,0,0,0,26.56,0L322.19,107.41a12.13,12.13,0,0,0-3.39-22.16c-.47.17-7.65,2.7-13.84-2a14.56,14.56,0,0,1-5.54-13.85,10.85,10.85,0,0,0-20.59-5.37L121.7,221.19A18.77,18.77,0,0,0,121.7,247.75Z" />
      <path class="edit-cls-5"
        d="M174.53,248.55c1,6.4-5.23,11.89-12.15,18-7.57,6.65-13,7.71-14.83,8a14.7,14.7,0,0,1-8.73-.76c-4.59-2.11-6.52-6.52-7.32-8.43-2.61-6.25-3.47-17.15,4-24.86,8.58-8.84,21.81-6.11,28.79-2.48C167,239.34,173.59,242.62,174.53,248.55Z" />
      <path class="edit-cls-4"
        d="M78.67,272.37a9.11,9.11,0,0,1,4.2-.63c8.65.34,17.63,6.73,23.1,15.26,2.7,4.23,8.33,13,4.94,19.39-1,1.91-2.36,2.72-16.42,7.52-14.65,5-18.23,5.84-22.15,3.95a13.75,13.75,0,0,1-5.93-5.73c-2.22-4.21-.6-7,4.35-24.33C73.28,279,74.44,274.16,78.67,272.37Z" />
      <ellipse class="edit-cls-1" cx="320.7" cy="65.54" rx="55.58" ry="51.69" />
      <path class="edit-cls-4"
        d="M372.58,78.36A25.85,25.85,0,0,0,361.45,49.8a25.47,25.47,0,0,0-14.73-4.24,25.08,25.08,0,0,0-10.67,2.79l-.39-.28a25.19,25.19,0,0,0,.08-11A25.49,25.49,0,0,0,328,23.79,25.88,25.88,0,0,0,297.57,20a27.44,27.44,0,0,0-11.4,12.63c-2.1,4.4-2.48,8-3.12,14a86.33,86.33,0,0,0-.13,16.49c.32,3.74.92,8.45,5.48,26.91,1.49,6,2.78,11,3.67,14.4l1-1.33h0l-1,1.33c3.52,0,8.65,0,14.86,0,19-.14,23.73-.71,27.43-1.33A86,86,0,0,0,350.32,99c5.67-2.09,9.09-3.36,12.83-6.47A27.44,27.44,0,0,0,372.58,78.36Z" />
      <path class="edit-cls-4"
        d="M33.68,332.4c5.29-6.5,16.51-20.26,29.63-19.34,19.84,1.38,18.6,34.56,40.22,41.9,37.35,12.7,95.47-67.85,126.15-55.87,20,7.82,6.06,46.43,26.67,53.37,20.88,7,60.6-24,75.44-56.13,5-10.84,5.74-18.66,5.42-18.73-.81-.19-5.13,49.31-43.61,75.22-17.54,11.81-46.13,21.37-59.69,12.53-20.41-13.31,5.83-60.16-6.77-65.54-16.26-7-60.38,71-106.68,65.54C92,362,83.61,329.64,62,332.4c-26.56,3.39-33.6,55-40.22,53.73C16.9,385.2,14.76,355.61,33.68,332.4Z" />
      <path class="edit-cls-5"
        d="M112.74,248c3.53,5.44,11.85,5.33,21.06,5.22,10.07-.13,14.81-3,16.36-4a14.7,14.7,0,0,0,6-6.42c2-4.64.48-9.2-.21-11.16-2.24-6.39-8.9-15.06-19.64-15.77-12.29-.81-20.29,10.06-23,17.43C112.21,236.05,109.47,242.93,112.74,248Z" />
    </svg>
  </button>
</form>
